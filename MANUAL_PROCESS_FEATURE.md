# 手动处理页面功能说明

## 功能概述

在现有的两个页签（首页和已处理图片）中间新增了一个"手动处理"页签，允许用户手动选择相册中的图片进行LUT处理。

## 新增功能特性

### 1. 手动处理页面 (ManualProcessScreen)
- **位置**: 位于首页和已处理图片页签之间
- **图标**: 使用相册图标 (PhotoLibrary)
- **功能**: 提供手动选择和处理图片的界面

### 2. 页面布局结构
```
顶部区域:
├── LUT文件选择下拉菜单
├── 处理参数设置
│   ├── 强度滑块 (0-100)
│   ├── 质量滑块 (1-100)
│   └── 抖动类型选择
└── 开始处理按钮

中间区域:
└── 相册图片网格展示
    ├── 支持多选
    ├── 选中状态指示
    └── 图片预览

底部区域:
└── 选中图片数量显示
```

### 3. 核心功能

#### 图片选择
- 自动加载手机相册中的图片
- 支持多选图片（复选框模式）
- 实时显示选中图片数量
- 图片网格布局，每行3张图片

#### LUT处理参数
- **LUT文件选择**: 从已导入的LUT文件中选择
- **强度设置**: 0-100的滑块控制
- **质量设置**: 1-100的滑块控制  
- **抖动类型**: 无/Floyd-Steinberg/随机抖动

#### 处理流程
1. 用户选择LUT文件和参数
2. 从相册中多选图片
3. 点击"开始处理"按钮
4. 系统创建处理队列项目
5. 启动后台处理服务
6. 实时显示处理进度
7. 处理完成的图片保存到输出目录

## 技术实现

### 1. 新增文件
- `ManualProcessScreen.kt`: 手动处理页面UI组件
- 更新了 `BottomNavigation.kt`: 添加新的导航项
- 更新了 `ProcessingEvents.kt`: 添加新的事件类型

### 2. 核心组件

#### ManualProcessScreen
```kotlin
@Composable
fun ManualProcessScreen(
    viewModel: MainViewModel,
    modifier: Modifier = Modifier
)
```

#### GalleryImage 数据类
```kotlin
data class GalleryImage(
    val id: Long,
    val path: String,
    val name: String,
    val size: Long,
    val dateModified: Long
)
```

#### loadGalleryImages 函数
- 使用 MediaStore API 加载相册图片
- 支持 Android 10+ 的分区存储
- 自动处理权限检查

### 3. 事件驱动架构
- 使用 `ProcessingEvents` 密封类管理事件
- 通过 `EventBus` 进行组件间通信
- 支持实时处理状态更新

### 4. 后台处理服务
- 扩展了 `FileMonitorService` 支持手动处理模式
- 添加了 `EXTRA_MANUAL_PROCESS` 和 `EXTRA_SELECTED_IMAGES` 参数
- 实现了 `processSelectedImages` 方法

## 用户体验特性

### 1. 权限管理
- 自动请求相册访问权限
- 兼容 Android 13+ 的细粒度媒体权限
- 优雅的权限拒绝处理

### 2. 实时反馈
- 处理进度实时显示
- 处理状态通知
- 错误信息提示

### 3. 响应式设计
- 自适应网格布局
- 流畅的选择动画
- Material Design 3 风格

### 4. 性能优化
- 图片懒加载
- 内存优化的图片显示
- 异步处理避免UI阻塞

## 使用流程

1. **打开应用**: 启动LUT图片处理器应用
2. **切换页签**: 点击底部导航栏的"手动处理"页签
3. **配置参数**: 
   - 选择要使用的LUT文件
   - 调整处理强度（推荐60-80）
   - 设置输出质量（推荐90）
   - 选择抖动类型（可选）
4. **选择图片**: 
   - 浏览相册图片网格
   - 点击图片进行多选
   - 查看选中数量提示
5. **开始处理**: 
   - 点击"开始处理"按钮
   - 观察处理进度
   - 等待处理完成
6. **查看结果**: 
   - 切换到"已处理图片"页签
   - 查看处理后的图片
   - 处理后的图片保存在设置的输出目录中

## 注意事项

1. **权限要求**: 需要相册访问权限
2. **存储空间**: 确保有足够的存储空间保存处理后的图片
3. **处理时间**: 处理时间取决于图片数量、大小和设备性能
4. **输出目录**: 需要在设置中配置输出目录
5. **LUT文件**: 需要先导入LUT文件才能进行处理

## 后续优化建议

1. **批量操作**: 添加全选/反选功能
2. **预览功能**: 添加处理前后对比预览
3. **格式支持**: 支持更多图片格式
4. **云端处理**: 集成云端LUT处理服务
5. **社交分享**: 添加处理结果分享功能